function o(t){return["white 0px 0px 5px","white 0px 0px 10px",`${t} 0px 0px 20px`,`${t} 0px 0px 30px`,`${t} 0px 0px 40px`,`${t} 0px 0px 55px`,`${t} 0px 0px 75px`].join(", ")}function h(t=10){let e=i.from_hex("#aaa");return[`${e.dim(t).toHex()} 0px 1px 0px`,`${e.dim(t*2).toHex()} 0px 2px 0px`,`${e.dim(t*3).toHex()} 0px 3px 0px`,`${e.dim(t*4).toHex()} 0px 4px 0px`,"rgba(0, 0, 0, 0.23) 0px 0px 5px","rgba(0, 0, 0, 0.43) 0px 1px 3px","rgba(0, 0, 0, 0.4) 1px 4px 6px","rgba(0, 0, 0, 0.38) 0px 5px 10px","rgba(0, 0, 0, 0.25) 3px 7px 12px"].join(", ")}var i=class{constructor(e=[0,0,0]){this.r=e[0],this.g=e[1],this.b=e[2]}static from_hex(e){if(e.match(/[\w\d]/g).length==3)var s=e.match(/[\w\d]/g),n=[parseInt(s[0],16)*17,parseInt(s[1],16)*17,parseInt(s[2],16)*17];else var s=e.match(/[\w\d]{2}/g),n=[parseInt(s[0],16),parseInt(s[1],16),parseInt(s[2],16)];return new i(n)}toHex(){let e=s=>s.toString(16).padStart(2,"0");return`#${e(this.r)}${e(this.g)}${e(this.b)}`}dim(e){let s=n=>Math.max(0,n-e);return this.r=s(this.r),this.g=s(this.g),this.b=s(this.b),this}bright(e){let s=n=>Math.min(255,n+e);return this.r=s(this.r),this.g=s(this.g),this.b=s(this.b),this}toCssRGB(){return`rgb(${this.r}, ${this.g}, ${this.b})`}};function r(t){return t.match(/[а-я]/i)?"cyr":"lat"}function l(t,e,s,n={x:0,y:0}){t.preventDefault();let a=10,x=n.x-t.clientX,p=n.y-t.clientY,g=Math.min(s.clientHeight-e.clientHeight-a,Math.max(0+a,e.offsetTop-p)),c=Math.min(s.clientWidth-e.clientWidth-a,Math.max(0+a,e.offsetLeft-x));return{dragStart:{y:t.clientY,x:t.clientX},state:{y:g+"px",x:c+"px"}}}document.addEventListener("alpine:init",()=>{Alpine.data("wnca",()=>({init(){this.colors=JSON.parse(this.$refs.colors_json.innerHTML),this.$watch("val.text",()=>this.onTextChange()),this.$watch("val.font",()=>this.onFontChange()),this.$watch("state.underlay",()=>this.onUnderlayChange()),this.$watch("state.spelling",(t,e)=>this.onSpellingChange(t,e)),this._fonts=JSON.parse(this.$refs.fonts_json.innerHTML),this.updateFonts()},_fonts:[],fonts:[],colors:[],getColorByHex(t){return this.colors.find(e=>e.color==t)},tabs:["Text","Font","Color"],activeTab:"Text",cache:{loadedFonts:[]},state:{dragged:!1,underlay:"no",spelling:"lat",font:null,color:{preview:"",detailPreview:""},text:{light:!0,align:"center",fontSize:"",dragStart:{x:0,y:0},x:"auto",y:"17%"}},val:{text:"",font:"",color:""},onUnderlayChange(){},onTextChange(){this.updateFontSize(),this.updateSpelling()},onFontChange(){this.updateFontSize()},onSpellingChange(t,e){e!==t&&this.updateFonts()},onColorChange(t){this.setColor(t)},onTabChange(t){this.setTab(t)},setTab(t){this.activeTab=t},setUnderlay(t){this.state.underlay=t},async setFont(t){this.cache.loadedFonts.includes(t.name)||document.fonts.add(await new FontFace(t.name,`url(${t.link})`,{style:"normal",weight:700}).load()),this.val.font=t.name,this.state.font=t,this.updateFontSize()},async setColor(t){this.state.color=t,this.val.color=t.color},getLightShadow(){return o(this.val.color)},getDarkShadow(){return h()},toggleLight(t){this.state.text.light=t},onTextDrag(t){this.state.dragged=!0;let{dragStart:e,state:s}=l(t,this.$refs.text,this.$refs.preview,this.state.text.dragStart);this.state.text.dragStart=e,this.state.text.x=s.x,this.state.text.y=s.y},get fontBaseSize(){return this.state.font.base_size},updateFonts(){let t=this.state.font==null,e=!t&&this.state.font.spelling.includes(this.state.spelling);this.fonts=this._fonts.filter(s=>s.spelling.includes(this.state.spelling)),(t||!e)&&this.setFont(this.fonts[0])},updateSpelling(){this.state.spelling=r(this.val.text)},updateFontSize(){let t=this.$refs.preview.clientWidth,e=this.$refs.text.clientWidth;this.state.text.fontSize=Math.min(this.fontBaseSize,this.state.text.fontSize/(e/t)),this.val.text.length==0&&(this.state.text.fontSize=this.fontBaseSize),parseInt(this.state.text.x)+e>t&&(this.state.text.x=t-e+"px")},get textValue(){return this.val.text.replaceAll("\\n","<br>")||"Your Text"},text:{["x-ref"]:"text",":style":`{
          top: state.text.y,
          left: state.text.x,
          fontFamily: val.font,
          fontSize: state.text.fontSize + 'px',
          textAlign: state.text.align,
          textShadow: state.text.light ? getLightShadow() : getDarkShadow(),
          color: state.text.light ? 'white' : val.color,
        }`,["@mousedown"](t){t=t||window.event,t.preventDefault(),this.state.text.dragStart.x=t.clientX,this.state.text.dragStart.y=t.clientY,document.onmouseup=()=>{document.onmouseup=null,document.onmousemove=null},document.onmousemove=this.onTextDrag.bind(this)}}}))});
//# sourceMappingURL=main.js.map
